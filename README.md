# Документация проекта

## Запуск приложения

Приложение принимает один аргумент - путь к файлу сценария:
```bash
./sw_battle_test commands_example.txt
```

Выводит в stdout все команды и события симуляции.
Файл сценария содержит последовательность команд (CREATE_MAP, SPAWN_*, MARCH).

## Генерация проекта

### Windows (Visual Studio)
```batch
# Генерация проекта
generate_vs_project.bat

# Обновление после изменений
update_vs_project.bat

# Сборка в Visual Studio
# Открыть build/sw_battle_test.sln
# Построить проект (F7)
```

### Linux/Mac (CMake)
```bash
# Создание build директории
mkdir build && cd build

# Генерация проекта
cmake ..

# Сборка
make

# Запуск
./sw_battle_test ../commands_example.txt
```

### Требования
- CMake 3.27+
- C++20 компилятор (clang 15+, gcc 10+, MSVC 2022)
- Только стандартная библиотека

## Основные способы расширения

### Добавление новых характеристик
1. Добавить новый тип в `PropertyType` enum в `src/Features/Properties/Properties.h`
2. Зарегистрировать тип через макрос `PROPERTY_TYPE_DECLARE`
3. Использовать в юнитах через `setProperty<Type>(value)`

### Добавление новых действий
1. Добавить новый тип в `ActionType` enum в `src/Features/Actions/Actions.h`
2. Реализовать класс действия, наследуясь от `Action`
3. Переопределить `tryExecute()` метод
4. Добавить действие юнитам через `addAvailableAction()`

### Добавление новых юнитов
1. Создать класс, наследуясь от `Unit`
2. Реализовать статический метод `create()` для фабрики
3. Установить характеристики через `setProperty()`
4. Добавить доступные действия через `addAvailableAction()`
5. Добавить команду спавна в `src/IO/Commands/`

### Добавление новых команд/событий
1. Создать структуру команды в `src/IO/Commands/`
2. Зарегистрировать в парсере в `main.cpp`
3. Создать структуру события в `src/IO/Events/`
4. Использовать `EventLogger` для логирования

---

# **Задача**

Создана пошаговую симуляцию боевых столкновений юнитов на карте для тестирования игровых механик в соотвествии со спецификацией:

На карте размером W×H клеток можно размещать юнитов.

- Юниты различаются по типам, **действиям** и **характеристикам**.
- Каждому юниту присвоен уникальный идентификатор **Id** (целое число)
- За один ход каждый юнит может выполнить одно действие.
  - Юниты совершают действия в порядке их создания.
- Юнит всегда размещен по каким то координатам на карте.
- Юнит может занимать клетку, не позволяя другим на нее встать.
- Большинство юнитов имеет характеристику **HP** (Health Points).
  - При **HP** ≤ 0 юнит выполняет свои действия в текущем ходу и исчезает перед началом следующего.
- Часть юнитов обладает способностью перемещения:
  - Они могут переместиться в любую из восьми прилегающих клеток за ход.
  - Если цель недостижима за один ход, они продолжают движение к ней в последующих ходах.
  - Статичные юниты должны оставаться неподвижными при любых условиях.

Симуляция заканчивается, когда нет юнитов, способных действовать в следующем ходу, или на карте остается только один юнит.

## Юниты:

### Мечник
- **Характеристики:** HP, Strength
- Действия
  - **Сокрушающий удар:** Бьет одного случайного юнита в соседней клетке, нанося ему **Strength** единиц урона.
  - Если некого бить, перемещается.

### Охотник
- **Характеристики:** HP, Agility, Strength, Range
- Действия
  - **Стремительный выстрел:** Стреляет в случайного юнита на расстоянии от 2 до **Range** клеток, нанося ему **Agility** единиц урона. Может стрелять только если в соседних клетках нет других юнитов.
  - **Удар из тени:** Если стрелять не может, бьет одного случайного юнита в соседней клетке, нанося ему **Strength** единиц урона.
  - Если некого бить, перемещается.

## Команды

- `CREATE_MAP W H` — Создает карту размером `W`×`H`. Эта команда начинает любой сценарий.
- `SPAWN_SWORDSMAN I X Y H S` — Создает мечника с идентификатором `I` в точке `X`,`Y` с характеристиками здоровья `H` и силы `S`.
- `SPAWN_HUNTER I X Y H A S R` — Создает охотника с идентификатором `I` в точке `X`,`Y` с характеристиками здоровья `H`, ловкости `A`, силы `S` и дальности `R`.
- `MARCH I X Y` — Приказывает юниту `I` переместиться в точку `X`,`Y`.

## События

- `MAP_CREATED` — Создание карты.
- `MARCH_STARTED`, `MARCH_ENDED` — Начало и конец перемещения юнита.
- `UNIT_SPAWNED`, `UNIT_DIED` — Создание и смерть юнита.
- `UNIT_MOVED` — Перемещение юнита на клетку.
- `UNIT_ATTACKED` — Атака одного юнита на другого.
